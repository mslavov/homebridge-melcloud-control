{
  "pluginAlias": "melcloudpassivehouse",
  "pluginType": "platform",
  "singular": true,
  "fixArrays": true,
  "strictValidation": true,
  "customUi": true,
  "headerDisplay": "Passive house climate control for Mitsubishi AC via MELCloud. Features predictive temperature management using weather forecasts, external temperature sensors (Shelly), and optional thermal learning via InfluxDB.",
  "footerDisplay": "For documentation please see [GitHub repository](https://github.com/mslavov/homebridge-melcloud-passive-house).",
  "schema": {
    "type": "object",
    "properties": {
      "accounts": {
        "type": "array",
        "title": "Accounts",
        "items": {
          "type": "object",
          "title": "Account",
          "properties": {
            "name": {
              "title": "Name",
              "type": "string",
              "placeholder": "Name",
              "description": "Your own account name displayed in HomeKit."
            },
            "user": {
              "title": "User",
              "type": "string",
              "placeholder": "Email",
              "description": "Account credential (username)."
            },
            "passwd": {
              "title": "Password",
              "type": "string",
              "placeholder": "Password",
              "description": "Account credential (password).",
              "format": "password"
            },
            "language": {
              "title": "Language",
              "type": "string",
              "minLength": 1,
              "maxLength": 2,
              "pattern": "^[0-9]+$",
              "default": "0",
              "description": "Here select the account language.",
              "anyOf": [
                { "title": "English", "enum": ["0"] },
                { "title": "Български", "enum": ["1"] },
                { "title": "Čeština", "enum": ["2"] },
                { "title": "Dansk", "enum": ["3"] },
                { "title": "Deutsch", "enum": ["4"] },
                { "title": "Eesti", "enum": ["5"] },
                { "title": "Español", "enum": ["6"] },
                { "title": "Français", "enum": ["7"] },
                { "title": "Հdelays", "enum": ["8"] },
                { "title": "Latviešu", "enum": ["9"] },
                { "title": "Lietuvių", "enum": ["10"] },
                { "title": "Magyar", "enum": ["11"] },
                { "title": "Nederlands", "enum": ["12"] },
                { "title": "Norwegian", "enum": ["13"] },
                { "title": "Polski", "enum": ["14"] },
                { "title": "Português", "enum": ["15"] },
                { "title": "Русский", "enum": ["16"] },
                { "title": "Suomi", "enum": ["17"] },
                { "title": "Svenska", "enum": ["18"] },
                { "title": "Italiano", "enum": ["19"] },
                { "title": "Українська", "enum": ["20"] },
                { "title": "Türkçe", "enum": ["21"] },
                { "title": "Ελληνικά", "enum": ["22"] },
                { "title": "Hrvatski", "enum": ["23"] },
                { "title": "Română", "enum": ["24"] },
                { "title": "Slovenščina", "enum": ["25"] }
              ]
            },
            "type": {
              "title": "Account Type",
              "type": "string",
              "default": "disabled",
              "description": "Here select the account type.",
              "anyOf": [
                { "title": "None / Disabled", "enum": ["disabled"] },
                { "title": "MELCLoud", "enum": ["melcloud"] }
              ]
            },
            "ataDevices": {
              "title": "ATA Devices",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "id": {
                    "title": "Id",
                    "type": "string",
                    "default": "0"
                  },
                  "type": {
                    "title": "Type",
                    "type": "integer",
                    "default": 0
                  },
                  "displayType": {
                    "title": "Display Type",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 1,
                    "default": 0,
                    "description": "Select accessory control type displayed in HomeKit.",
                    "anyOf": [
                      { "title": "None / Disabled", "enum": [0] },
                      { "title": "Heater / Cooler", "enum": [1] }
                    ]
                  },
                  "name": {
                    "title": "Name",
                    "type": "string",
                    "default": "Air Conditioner",
                    "description": "Here set Your own name displayed in HomeKit."
                  },
                  "targetTemperature": {
                    "title": "Target Temperature (°C)",
                    "type": "number",
                    "default": 23,
                    "minimum": 18,
                    "maximum": 28,
                    "description": "Target midpoint temperature. HomeKit shows ±3°C comfort band around this value."
                  },
                  "location": {
                    "title": "Location",
                    "type": "object",
                    "description": "Location coordinates for weather forecast (required for predictive control).",
                    "properties": {
                      "latitude": {
                        "title": "Latitude",
                        "type": "number",
                        "minimum": -90,
                        "maximum": 90,
                        "description": "Location latitude in decimal degrees (e.g., 42.6977 for Sofia)."
                      },
                      "longitude": {
                        "title": "Longitude",
                        "type": "number",
                        "minimum": -180,
                        "maximum": 180,
                        "description": "Location longitude in decimal degrees (e.g., 23.3219 for Sofia)."
                      }
                    },
                    "required": ["latitude", "longitude"]
                  },
                  "externalSensor": {
                    "title": "External Temperature Sensor",
                    "type": "object",
                    "description": "External temperature sensor configuration (required for accurate room temperature).",
                    "properties": {
                      "type": {
                        "title": "Sensor Type",
                        "type": "string",
                        "default": "shelly",
                        "description": "Type of external sensor.",
                        "oneOf": [
                          { "title": "Shelly Cloud", "enum": ["shelly"] }
                        ]
                      },
                      "shellyServerUri": {
                        "title": "Shelly Server URI",
                        "type": "string",
                        "placeholder": "shelly-58-eu.shelly.cloud",
                        "description": "Shelly Cloud server URI (found in Shelly App -> User Settings)."
                      },
                      "shellyAuthKey": {
                        "title": "Shelly Auth Key",
                        "type": "string",
                        "description": "Shelly Cloud API authentication key."
                      },
                      "shellyDeviceId": {
                        "title": "Shelly Device ID",
                        "type": "string",
                        "description": "Shelly device ID (found in Device -> Settings -> Device Information)."
                      },
                      "pollInterval": {
                        "title": "Poll Interval (seconds)",
                        "type": "integer",
                        "default": 60,
                        "minimum": 30,
                        "maximum": 300,
                        "description": "How often to poll the external sensor."
                      }
                    },
                    "required": ["shellyServerUri", "shellyAuthKey", "shellyDeviceId"]
                  },
                  "influxDb": {
                    "title": "InfluxDB Logging",
                    "type": "object",
                    "description": "Optional InfluxDB 1.8 logging for thermal data analysis and learning.",
                    "properties": {
                      "enabled": {
                        "title": "Enable InfluxDB Logging",
                        "type": "boolean",
                        "default": false,
                        "description": "Enable logging thermal data to InfluxDB for analysis."
                      },
                      "host": {
                        "title": "InfluxDB Host",
                        "type": "string",
                        "default": "localhost",
                        "description": "InfluxDB server hostname or IP address."
                      },
                      "port": {
                        "title": "InfluxDB Port",
                        "type": "integer",
                        "default": 8086,
                        "minimum": 1,
                        "maximum": 65535,
                        "description": "InfluxDB server port."
                      },
                      "database": {
                        "title": "Database Name",
                        "type": "string",
                        "default": "homebridge",
                        "description": "InfluxDB database name."
                      },
                      "username": {
                        "title": "Username",
                        "type": "string",
                        "description": "InfluxDB username (optional if no auth)."
                      },
                      "password": {
                        "title": "Password",
                        "type": "string",
                        "description": "InfluxDB password (optional if no auth).",
                        "format": "password"
                      },
                      "retentionDays": {
                        "title": "Retention (days)",
                        "type": "integer",
                        "default": 30,
                        "minimum": 7,
                        "maximum": 365,
                        "description": "How long to keep thermal data."
                      }
                    }
                  }
                },
                "required": [
                  "displayType",
                  "location",
                  "externalSensor"
                ]
              }
            },
            "refreshInterval": {
              "title": "Refresh Interval",
              "type": "integer",
              "default": 120,
              "minimum": 1,
              "maximum": 600,
              "description": "Set the background account data refresh time in seconds.",
              "condition": {
                "functionBody": "return model.accounts[arrayIndices[0]].type === 'melcloud';"
              }
            },
            "log": {
              "title": "Log",
              "type": "object",
              "properties": {
                "deviceInfo": {
                  "title": "Device Info",
                  "type": "boolean",
                  "default": true,
                  "description": "This enable logging device info on plugin start."
                },
                "success": {
                  "title": "Success",
                  "type": "boolean",
                  "default": true
                },
                "info": {
                  "title": "Info",
                  "type": "boolean",
                  "default": false
                },
                "warn": {
                  "title": "Warn",
                  "type": "boolean",
                  "default": true
                },
                "error": {
                  "title": "Error",
                  "type": "boolean",
                  "default": true
                },
                "debug": {
                  "title": "Debug",
                  "type": "boolean",
                  "default": false
                }
              }
            }
          },
          "required": [
            "name",
            "user",
            "passwd",
            "language",
            "type"
          ]
        }
      }
    }
  },
  "layout": [
    {
      "key": "accounts",
      "type": "tabarray",
      "title": "{{ value.name || 'account' }}",
      "items": [
        "accounts[].name",
        "accounts[].user",
        {
          "key": "accounts[].passwd",
          "type": "password"
        },
        "accounts[].language",
        "accounts[].type",
        {
          "key": "accounts[].ataDevices",
          "type": "tabarray",
          "title": "{{ value.name }}",
          "items": [
            {
              "key": "accounts[].ataDevices[].id",
              "readonly": true
            },
            "accounts[].ataDevices[].displayType",
            {
              "title": "Predictive Control",
              "type": "section",
              "description": "Passive house predictive temperature control settings",
              "expandable": true,
              "expanded": true,
              "items": [
                "accounts[].ataDevices[].name",
                "accounts[].ataDevices[].targetTemperature"
              ],
              "condition": {
                "functionBody": "return model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].displayType > 0;"
              }
            },
            {
              "title": "Location",
              "type": "section",
              "description": "Location for weather forecast (required)",
              "expandable": true,
              "expanded": true,
              "items": [
                "accounts[].ataDevices[].location.latitude",
                "accounts[].ataDevices[].location.longitude"
              ],
              "condition": {
                "functionBody": "return model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].displayType > 0;"
              }
            },
            {
              "title": "External Sensor",
              "type": "section",
              "description": "External temperature sensor (required)",
              "expandable": true,
              "expanded": true,
              "items": [
                "accounts[].ataDevices[].externalSensor.type",
                "accounts[].ataDevices[].externalSensor.shellyServerUri",
                "accounts[].ataDevices[].externalSensor.shellyAuthKey",
                "accounts[].ataDevices[].externalSensor.shellyDeviceId",
                "accounts[].ataDevices[].externalSensor.pollInterval"
              ],
              "condition": {
                "functionBody": "return model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].displayType > 0;"
              }
            },
            {
              "title": "InfluxDB Logging",
              "type": "section",
              "description": "Optional thermal data logging to InfluxDB",
              "expandable": true,
              "expanded": false,
              "items": [
                "accounts[].ataDevices[].influxDb.enabled",
                "accounts[].ataDevices[].influxDb.host",
                "accounts[].ataDevices[].influxDb.port",
                "accounts[].ataDevices[].influxDb.database",
                "accounts[].ataDevices[].influxDb.username",
                "accounts[].ataDevices[].influxDb.password",
                "accounts[].ataDevices[].influxDb.retentionDays"
              ],
              "condition": {
                "functionBody": "return model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].displayType > 0;"
              }
            }
          ],
          "condition": {
            "functionBody": "return model.accounts[arrayIndices[0]].type !== 'disabled';"
          }
        },
        {
          "key": "accounts[]",
          "type": "section",
          "title": "Advanced Settings",
          "expandable": true,
          "expanded": false,
          "items": [
            "accounts[].refreshInterval",
            {
              "key": "accounts[].log",
              "title": "Log",
              "items": [
                "accounts[].log.deviceInfo",
                "accounts[].log.success",
                "accounts[].log.info",
                "accounts[].log.warn",
                "accounts[].log.error",
                "accounts[].log.debug"
              ]
            }
          ],
          "condition": {
            "functionBody": "return model.accounts[arrayIndices].type !== 'disabled';"
          }
        }
      ]
    }
  ]
}
