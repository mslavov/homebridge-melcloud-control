{
  "pluginAlias": "melcloudcontrol",
  "pluginType": "platform",
  "singular": true,
  "fixArrays": true,
  "strictValidation": true,
  "customUi": true,
  "headerDisplay": "Plugin for Mitsubishi Air Conditioner (ATA devices) connected to MELCloud. Devices are exposed to HomeKit as separate accessories and each needs to be manually [paired](https://github.com/grzegorz914/homebridge-melcloud-control/wiki#adding-to-homekit).",
  "footerDisplay": "For documentation please see [GitHub repository](https://github.com/grzegorz914/homebridge-melcloud-control).",
  "schema": {
    "type": "object",
    "properties": {
      "accounts": {
        "type": "array",
        "title": "Accounts",
        "items": {
          "type": "object",
          "title": "Account",
          "properties": {
            "name": {
              "title": "Name",
              "type": "string",
              "placeholder": "Name",
              "description": "Your own account name displayed in HomeKit."
            },
            "user": {
              "title": "User",
              "type": "string",
              "placeholder": "Email",
              "description": "Account credential (username)."
            },
            "passwd": {
              "title": "Password",
              "type": "string",
              "placeholder": "Password",
              "description": "Account credential (password).",
              "format": "password"
            },
            "language": {
              "title": "Language",
              "type": "string",
              "minLength": 1,
              "maxLength": 2,
              "pattern": "^[0-9]+$",
              "default": "0",
              "description": "Here select the account language.",
              "anyOf": [
                { "title": "English", "enum": ["0"] },
                { "title": "Български", "enum": ["1"] },
                { "title": "Čeština", "enum": ["2"] },
                { "title": "Dansk", "enum": ["3"] },
                { "title": "Deutsch", "enum": ["4"] },
                { "title": "Eesti", "enum": ["5"] },
                { "title": "Español", "enum": ["6"] },
                { "title": "Français", "enum": ["7"] },
                { "title": "Հdelays", "enum": ["8"] },
                { "title": "Latviešu", "enum": ["9"] },
                { "title": "Lietuvių", "enum": ["10"] },
                { "title": "Magyar", "enum": ["11"] },
                { "title": "Nederlands", "enum": ["12"] },
                { "title": "Norwegian", "enum": ["13"] },
                { "title": "Polski", "enum": ["14"] },
                { "title": "Português", "enum": ["15"] },
                { "title": "Русский", "enum": ["16"] },
                { "title": "Suomi", "enum": ["17"] },
                { "title": "Svenska", "enum": ["18"] },
                { "title": "Italiano", "enum": ["19"] },
                { "title": "Українська", "enum": ["20"] },
                { "title": "Türkçe", "enum": ["21"] },
                { "title": "Ελληνικά", "enum": ["22"] },
                { "title": "Hrvatski", "enum": ["23"] },
                { "title": "Română", "enum": ["24"] },
                { "title": "Slovenščina", "enum": ["25"] }
              ]
            },
            "type": {
              "title": "Account Type",
              "type": "string",
              "default": "disabled",
              "description": "Here select the account type.",
              "anyOf": [
                { "title": "None / Disabled", "enum": ["disabled"] },
                { "title": "MELCLoud", "enum": ["melcloud"] }
              ]
            },
            "ataDevices": {
              "title": "ATA Devices",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "id": {
                    "title": "Id",
                    "type": "string",
                    "default": "0"
                  },
                  "type": {
                    "title": "Type",
                    "type": "integer",
                    "default": 0
                  },
                  "displayType": {
                    "title": "Display Type",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 1,
                    "default": 0,
                    "description": "Select accessory control type displayed in HomeKit.",
                    "anyOf": [
                      { "title": "None / Disabled", "enum": [0] },
                      { "title": "Heater / Cooler", "enum": [1] }
                    ]
                  },
                  "name": {
                    "title": "Name",
                    "type": "string",
                    "default": "Air Conditioner",
                    "description": "Here set Your own name displayed in HomeKit."
                  },
                  "heatDryFanMode": {
                    "title": "Heat",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 3,
                    "default": 1,
                    "description": "Select the operating mode for Heat, work only if mode supported by device.",
                    "anyOf": [
                      { "title": "None / Disabled", "enum": [0] },
                      { "title": "Heat", "enum": [1] },
                      { "title": "Dry", "enum": [2] },
                      { "title": "Fan", "enum": [3] }
                    ]
                  },
                  "coolDryFanMode": {
                    "title": "Cool",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 3,
                    "default": 1,
                    "description": "Select the operating mode for Cool, work only if mode supported by device.",
                    "anyOf": [
                      { "title": "None / Disabled", "enum": [0] },
                      { "title": "Cool", "enum": [1] },
                      { "title": "Dry", "enum": [2] },
                      { "title": "Fan", "enum": [3] }
                    ]
                  },
                  "autoDryFanMode": {
                    "title": "Auto",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 3,
                    "default": 1,
                    "description": "Select the operating mode for Auto, work only if mode supported by device.",
                    "anyOf": [
                      { "title": "None / Disabled", "enum": [0] },
                      { "title": "Auto", "enum": [1] },
                      { "title": "Dry", "enum": [2] },
                      { "title": "Fan", "enum": [3] }
                    ]
                  },
                  "externalSensor": {
                    "title": "External Temperature Sensor",
                    "type": "object",
                    "properties": {
                      "enabled": {
                        "title": "Enable External Sensor",
                        "type": "boolean",
                        "default": false,
                        "description": "Enable external temperature sensor for more accurate room temperature readings."
                      },
                      "type": {
                        "title": "Sensor Type",
                        "type": "string",
                        "default": "shelly",
                        "description": "Type of external sensor.",
                        "oneOf": [
                          { "title": "Shelly Cloud", "enum": ["shelly"] }
                        ],
                        "condition": {
                          "functionBody": "return model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].externalSensor?.enabled === true;"
                        }
                      },
                      "shellyServerUri": {
                        "title": "Shelly Server URI",
                        "type": "string",
                        "placeholder": "shelly-58-eu.shelly.cloud",
                        "description": "Shelly Cloud server URI (found in Shelly App -> User Settings).",
                        "condition": {
                          "functionBody": "return model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].externalSensor?.enabled === true && model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].externalSensor?.type === 'shelly';"
                        }
                      },
                      "shellyAuthKey": {
                        "title": "Shelly Auth Key",
                        "type": "string",
                        "description": "Shelly Cloud API authentication key.",
                        "condition": {
                          "functionBody": "return model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].externalSensor?.enabled === true && model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].externalSensor?.type === 'shelly';"
                        }
                      },
                      "shellyDeviceId": {
                        "title": "Shelly Device ID",
                        "type": "string",
                        "description": "Shelly device ID (found in Device -> Settings -> Device Information).",
                        "condition": {
                          "functionBody": "return model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].externalSensor?.enabled === true && model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].externalSensor?.type === 'shelly';"
                        }
                      },
                      "compensationEnabled": {
                        "title": "Enable Temperature Compensation",
                        "type": "boolean",
                        "default": true,
                        "description": "Automatically adjust target temperature to compensate for sensor offset.",
                        "condition": {
                          "functionBody": "return model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].externalSensor?.enabled === true;"
                        }
                      },
                      "hysteresis": {
                        "title": "Hysteresis (°C)",
                        "type": "number",
                        "default": 0.5,
                        "minimum": 0,
                        "maximum": 3,
                        "description": "Minimum temperature offset before compensation is applied.",
                        "condition": {
                          "functionBody": "return model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].externalSensor?.enabled === true && model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].externalSensor?.compensationEnabled === true;"
                        }
                      },
                      "pollInterval": {
                        "title": "Poll Interval (seconds)",
                        "type": "integer",
                        "default": 60,
                        "minimum": 30,
                        "maximum": 300,
                        "description": "How often to poll the external sensor.",
                        "condition": {
                          "functionBody": "return model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].externalSensor?.enabled === true;"
                        }
                      }
                    }
                  }
                },
                "required": [
                  "displayType",
                  "heatDryFanMode",
                  "coolDryFanMode",
                  "autoDryFanMode"
                ]
              }
            },
            "refreshInterval": {
              "title": "Refresh Interval",
              "type": "integer",
              "default": 120,
              "minimum": 1,
              "maximum": 600,
              "description": "Set the background account data refresh time in seconds.",
              "condition": {
                "functionBody": "return model.accounts[arrayIndices[0]].type === 'melcloud';"
              }
            },
            "log": {
              "title": "Log",
              "type": "object",
              "properties": {
                "deviceInfo": {
                  "title": "Device Info",
                  "type": "boolean",
                  "default": true,
                  "description": "This enable logging device info on plugin start."
                },
                "success": {
                  "title": "Success",
                  "type": "boolean",
                  "default": true
                },
                "info": {
                  "title": "Info",
                  "type": "boolean",
                  "default": false
                },
                "warn": {
                  "title": "Warn",
                  "type": "boolean",
                  "default": true
                },
                "error": {
                  "title": "Error",
                  "type": "boolean",
                  "default": true
                },
                "debug": {
                  "title": "Debug",
                  "type": "boolean",
                  "default": false
                }
              }
            }
          },
          "required": [
            "name",
            "user",
            "passwd",
            "language",
            "type"
          ]
        }
      }
    }
  },
  "layout": [
    {
      "key": "accounts",
      "type": "tabarray",
      "title": "{{ value.name || 'account' }}",
      "items": [
        "accounts[].name",
        "accounts[].user",
        {
          "key": "accounts[].passwd",
          "type": "password"
        },
        "accounts[].language",
        "accounts[].type",
        {
          "key": "accounts[].ataDevices",
          "type": "tabarray",
          "title": "{{ value.name }}",
          "items": [
            {
              "key": "accounts[].ataDevices[].id",
              "readonly": true
            },
            "accounts[].ataDevices[].displayType",
            {
              "title": "Settings",
              "type": "section",
              "description": "Device settings",
              "expandable": true,
              "expanded": false,
              "items": [
                "accounts[].ataDevices[].name",
                "accounts[].ataDevices[].heatDryFanMode",
                "accounts[].ataDevices[].coolDryFanMode",
                "accounts[].ataDevices[].autoDryFanMode"
              ],
              "condition": {
                "functionBody": "return model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].displayType > 0;"
              }
            },
            {
              "title": "External Sensor",
              "type": "section",
              "description": "External temperature sensor settings",
              "expandable": true,
              "expanded": false,
              "items": [
                "accounts[].ataDevices[].externalSensor.enabled",
                "accounts[].ataDevices[].externalSensor.type",
                "accounts[].ataDevices[].externalSensor.shellyServerUri",
                "accounts[].ataDevices[].externalSensor.shellyAuthKey",
                "accounts[].ataDevices[].externalSensor.shellyDeviceId",
                "accounts[].ataDevices[].externalSensor.compensationEnabled",
                "accounts[].ataDevices[].externalSensor.hysteresis",
                "accounts[].ataDevices[].externalSensor.pollInterval"
              ],
              "condition": {
                "functionBody": "return model.accounts[arrayIndices[0]].ataDevices[arrayIndices[1]].displayType > 0;"
              }
            }
          ],
          "condition": {
            "functionBody": "return model.accounts[arrayIndices[0]].type !== 'disabled';"
          }
        },
        {
          "key": "accounts[]",
          "type": "section",
          "title": "Advanced Settings",
          "expandable": true,
          "expanded": false,
          "items": [
            "accounts[].refreshInterval",
            {
              "key": "accounts[].log",
              "title": "Log",
              "items": [
                "accounts[].log.deviceInfo",
                "accounts[].log.success",
                "accounts[].log.info",
                "accounts[].log.warn",
                "accounts[].log.error",
                "accounts[].log.debug"
              ]
            }
          ],
          "condition": {
            "functionBody": "return model.accounts[arrayIndices].type !== 'disabled';"
          }
        }
      ]
    }
  ]
}
